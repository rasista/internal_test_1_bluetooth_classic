#ifndef LMP_GET_DEF_H
#define LMP_GET_DEF_H
#include <stdint.h>

{% for cmd, details in lmp_cmds.items() -%}
/* {{cmd | upper }} */
{% set offset = namespace(value = 3) -%}
{% set fieldsize = namespace(value = 0) -%}  {# Initialize fieldsize with a default value #}
#define GET_{{cmd | upper}}_TID(buf) ((buf[3] & (BIT(7)))>>7)
{% if details['EXTENDED_OPCODE'] != 0 -%}
#define GET_{{cmd | upper}}_OPCODE(buf)  (buf[3]) & ~(BIT(7))
#define GET_{{cmd | upper}}_EXTENDED_OPCODE(buf)  (buf[4])
{% set offset.value = offset.value + 2 -%}
{% if details['parameters'] != 0 -%}
{% for key, size in details['parameters'].items()-%}
{% if size == 1%}
#define GET_{{cmd | upper}}_PARAMETER_{{key | upper}}(buf)  buf[{{offset.value}}] 
{% elif size == 2 %}
#define GET_{{cmd | upper}}_PARAMETER_{{key | upper}}(buf)  ((uint16_t *)&buf[{{offset.value}}]) 
{% elif size == 3 %}
#define GET_{{cmd | upper}}_PARAMETER_{{key | upper}}(buf)  ((uint32_t *)&buf[{{offset.value}}]) & ~(BIT(24)) 
{% elif size == 4 %}
#define GET_{{cmd | upper}}_PARAMETER_{{key | upper}}(buf)  (uint32_t *)&buf[{{offset.value}}] 
{% else -%}
#define GET_{{cmd | upper}}_PARAMETER_{{key | upper}}(buf)  (buf[{{offset.value}}])
{% endif -%}
{% set offset.value = offset.value + (0 if type_check(size, 'dict') else size) + fieldsize.value -%} 
{% endfor -%}  
{% endif -%}   
{% else -%}
#define GET_{{cmd | upper}}_OPCODE(buf) ((buf[3]) & ~(BIT(7)))
{% set offset.value = offset.value + 1 -%}
{% if details['parameters'] != 0-%}
{% for key, size in details['parameters'].items()-%}
{% if size == 1-%}
#define GET_{{cmd | upper}}_PARAMETER_{{key | upper}}(buf)  buf[{{offset.value}}] 
{% elif size == 2 -%}
#define GET_{{cmd | upper}}_PARAMETER_{{key | upper}}(buf)  ((uint16_t *)&buf[{{offset.value}}]) 
{% elif size == 3 -%}
#define GET_{{cmd | upper}}_PARAMETER_{{key | upper}}(buf)  ((uint32_t *)&buf[{{offset.value}}]) & ~(BIT(24)) 
{% elif size == 4-%}
#define GET_{{cmd | upper}}_PARAMETER_{{key | upper}}(buf)  (uint32_t *)&buf[{{offset.value}}] 
{% else -%}
#define GET_{{cmd | upper}}_PARAMETER_{{key | upper}}(buf)  (buf[{{offset.value}}])
{% endif -%}
{% set offset.value = offset.value + (0 if type_check(size, 'dict') else size) + fieldsize.value -%} 
{% endfor -%} 
{% endif -%}
{% endif-%} 
{% endfor -%}
#endif